<!DOCTYPE html>
<html>

<head>
  <title> Hoyos Comentarios</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=500, user-scalable=no" />
  
  <link href="css/style.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  

</head>

<body>
  <div class="row" >
    <header class="bodyComentarios" style="text-align: center;
      color: #ffffff;
      font-family: cursive;
      border-radius: 10px;
      height: 100%;">

      <div class="col-lg-5" style="padding-top: 8%;
      padding-bottom: 8%;">
        <h3 style="padding: 5%;
        font-size: 33px;
        /* width: 100%; */
        margin-right: 10%;
        background-color: rgb(47 122 161 / 56%);">Espacio vecinal, votaciones y comentarios</h3>
      </div>
    </header>
  </div>

  <nav th:replace="layouts/fragmentoUsuarios :: nav"></nav>
 
    <hr>
    
    <div class="container" id="containerComentario">
      <div class="col-lg-9" id="textoExplicacion" style=" 
 
 margin-bottom: 0%;">
      <hr>
      <p>
        Desde aquí podrás votar las propuestas, enriquecerlas con comentarios o quitar tu voto si te arrepientes. Si no estas de acuerdo también podrás dar tu opinión, esta será tenida en cuenta a la hora de discutirla en el pleno. Este es un espacio para votar y debatir mejoras para el pueblo, los usuarios que hagan comentarios ofensivos o falten el respeto a los demás, serán dados de baja automáticamente.
      </br>
        Esperamos que te guste y que lo disfrutes.
      </p>
      <hr>

    </div>
      
    <div class="row">
      <div class="col-lg-9" data-bs-spy="scroll" id="cajaComentarios">
      <a type="button" th:href="@{/usuario}"class="btn" 
      style="color: #eeeeee;background-color: #463232a3;float: right;"
      aria-label="Close">Cerrar</a>
        <div class="row" style="padding: 1%;">
          
          <div class="row"  style="padding: 1%;">
            <div class="col-lg-6">
              <div id="puntuacionTotal" style="margin-bottom: 5%;"></div>
            </div>
            <div class="col-lg-2" style="margin-bottom: 3%;">
              <form th:action="@{/puntuacionMas}" id="puntuacionMass" method="get">
                <input type="hidden" name="mas" value="mas">
                <input type="hidden" name="titulo" th:value="${propuestas.titulo}" >
                <input type="submit" class="btn " style="color: #eeeeee;background-color: #463232a3;margin-left: 1%;" value=" Voto a favor " >
              </form>
            </div>

            <div class="col-lg-2" >
              <form th:action="@{/puntuacionMenos}" method="get">
                <input type="hidden" name="menos" value="menos">
                <input type="hidden" name="titulo" th:value="${propuestas.titulo}" >
                <input type="submit" class="btn" style="color: #eeeeee;background-color: #463232a3;margin-left: 1%;" value="Quitar tu voto" >

              </form>
            </div>
          </div>
        </div>

        <div class="row"  style="padding: 1%;">
          <p id="propuesta" th:text="${'Titulo: '+propuestas.titulo}" ></p>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <div disabled th:text="${propuestas.propuesta}" id="comentarioTextoPropuesta"></div>
          </div>
          <hr style="margin-top: 2%;">
        </div>
        <div class="row">

          <table class="table-responsive table-striped "
            id="tablaComentarios"> 
            <thead style="display: block;">

            </thead>
            <tbody th:if="comentarios" th:each="comentario:${comentarios}">
              <tr>
                <td><img class="logo  float-left" style="width: 50px ;float: left; border-radius: 90px;"
                    th:src="@{'/uploads/'+${comentario.usuario.foto}}"></td>
              </tr>
              <tr>
                <td style=" border-style: solid;font-weight: bold;"
                  th:text="${comentario.usuario.nombre.toUpperCase()}"></td>

              </tr>

              <tr>

              </tr>
              <tr>
                <div>
                  <td>
                    <div>
                      <p id="textoComentarios" 
                      th:text="'Ha dicho:  '+${comentario.comentario}" disabled></p>
                    </div>
                  </td>
                </div>
              </tr>

              <tr>
                <td th:if="${comentario.editable != null}">
                  <div style="display: flex;">
                    <button type="submit" class="btn btn-dark" data-bs-toggle="modal" value="Editar"
                      th:attr="data-bs-target='#staticBackdrop1'+${comentario.id}" style="color: #eeeeee;background-color: #463232a3; margin-bottom: 30px;margin-right: 1%;
            float: left;" th:id="${comentario.id}">
                      Editar
                    </button>
                    <form th:action="@{/borrarComentario}" method="post">

                      <input type="hidden" name="idComentario" th:value="${comentario.id}">
                      <input type="hidden" name="idPropuesta" th:value="${comentario.propuesta.idPropuesta}">

                      <input type="submit" class="btn" value="Borrar"
                        style="color: #eeeeee;background-color: #463232a3; margin-bottom: 30px;">
                    </form>

                  </div>
                </td>
              </tr>
              <div class="modal fade gh" th:id="staticBackdrop1+${comentario.id}" data-bs-backdrop="static"
                data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel1" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="staticBackdropLabel">Comentario</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <form th:action="@{/editarComentario}" method="get">
                        <textarea class="form-control" th:id="${comentario.id}" name="comentario" th:value="${comentario.comentario}"
                          th:text="${comentario.comentario}" rows="4" cols="50"
                          style=" height: 180px; width: 98%; margin-top: 10px;" maxlength="255">
        </textarea>
                        <input type="hidden" name="idComentario" th:value="${comentario.id}">
                        <input type="submit" id="enviarPropuesta" value="enviar">
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>

            </tbody>
            <tbody id="todosLosComentarios"></tbody>

          </table>
        </div>



        <div class="row">


        </div>
      </div>
    </div>
    <div class="row" style="margin-bottom: 5%;">
      <div class="col-lg-9" id="cajaAbajoComentarios">
        <div class="row">
          <div class="col-lg-12">
            <textarea type="text" id="comentario" name="comentario" class="form-control" maxlength="250" required></textarea>
          </div>
        </div>
        <div class="row" style="margin-top: 2%;">
          <div class="col-lg-12">
            <button class="btn " style="color: #eeeeee;background-color: #463232a3;" id="salvarComentario">Agregar Comentario</button>
          
            <a type="button" th:href="@{/usuario}" class="btn btn-dark" style="color: #eeeeee;background-color: #463232a3;float: right;"
              id="cerrarComentario">Cerrar</a>
          </div>
        </div>

      </div>

    </div>
  </div>


  <script th:src="@{js/jquery.min.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
  crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <!-- <script src="js/todosComentarios.js"></script> -->
  <script src="js/salvarComentario.js"></script>

</body>



<script>


  // $('#puntuacionMass').on('click', function(){ 
  // alert('Prevenido');

  // setTimeout(() => {
  $(document).ready(function script() {
    $.ajax({

      type: 'GET',
      url: "puntuacionTotal",
      //url: "https://cuevas-de-ayllon.com/puntuacionTotal",
    }).done(function (data) {


      console.log("Hecho Correcto!");
      console.log('el numero de graficos es:  ', data);
      var html2 = '';
      html2 += '<p id="recuperacion" >Esta propuesta tiene: ' + data + ' votos</p>';

      $('#puntuacionTotal').append(html2);
      $.ajax({

        type: 'GET',
        url: "guardarTotal",
        //url: "https://cuevas-de-ayllon.com/guardarTotal",
        data: { 'total': data }

      });


    }).fail(function () {
      console.log("Fallo!");
    })
      .always(function () {
        console.log("Completo!");
      });
  });

</script>

<script>
  // $(document).ready(function script() {
  // $('#puntuacionMass').on('submit', function () {
  //   var texto = $('#recuperacion').text();
  //   console.log('Esta es la propuesta que recuperamos', texto);

    // $.ajax({

    //   type: 'GET',
    //   url: "guardarTotal",
    // }).done(function (data) {


    //   console.log("Hecho Correcto!");
    //   console.log('Esta propuesta tiene:  ', data, ' puntos');






    // }).fail(function () {
    //   console.log("Fallo!");
    // })
    //   .always(function () {
    //     console.log("Completo!");
    //});

    //   $.ajax({
 
    //     type: 'GET',
    //     url: "puntuacionTotal",
    //   }).done(function (data) {


    //     console.log("Hecho Correcto!");

    //   }).fail(function () {
    //     console.log("Fallo!");
    //   })
    //     .always(function () {
    //       console.log("Completo!");
    //     });
  // });


    // lo que queramos hacer




</script>

</html>